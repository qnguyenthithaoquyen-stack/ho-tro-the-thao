<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quên mật khẩu - Hỗ Trợ Huấn Luyện Thể Thao</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    :root { --primary-color:#008080; }

    *{box-sizing:border-box}
    body{font-family:'Roboto',sans-serif;margin:0;background:#f0f2f5;color:#2c3e50}

    .container{max-width:1200px;margin:0 auto;background:#fff;box-shadow:0 0 15px rgba(0,0,0,.07);min-height:100dvh;display:flex;flex-direction:column}

    /* Header */
    .header{
      display:flex;justify-content:space-between;align-items:center;
      padding:15px 30px;background:var(--primary-color);color:#fff;
    }
    .header-left{display:flex;align-items:center;gap:15px;}
    .logo{background:#fff;color:var(--primary-color);font-weight:700;padding:10px;border-radius:5px;}
    .project-info h1{font-size:24px;margin:0;font-weight:700;}
    .project-info p{font-size:12px;margin:0;opacity:.9;}

    /* User actions (login/register/logout) */
    .user-actions{display:flex;align-items:center;gap:12px;}
    .user-actions a{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:9px 22px;font-size:14px;font-weight:500;border-radius:50px;
      text-decoration:none;border:1.5px solid #fff;transition:.3s;
    }
    .user-actions a svg{width:16px;height:16px}

    #login-link{background:transparent;color:#fff;}
    #login-link:hover{background:#fff;color:var(--primary-color);}
    #register-link,#logout-link{background:#fff;color:var(--primary-color);}
    #register-link:hover,#logout-link:hover{background:rgba(255,255,255,.9);}

    /* Nav */
    .navbar{display:flex;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,.05);padding:0 30px;}
    .navbar a{padding:15px 25px;text-decoration:none;color:#333;font-weight:500;position:relative;transition:color .3s;}
    .navbar a::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:0;height:3px;background:var(--primary-color);transition:width .3s;}
    .navbar a:hover,.navbar a.active{color:var(--primary-color);}
    .navbar a.active::after{width:70%;}

    /* Main */
    main{flex:1;background:#eef1f4;padding:48px 20px;display:flex;align-items:flex-start;justify-content:center;}
    .card{
      width:min(720px,100%);margin-top:24px;background:#fff;border-radius:20px;
      box-shadow:0 10px 40px rgba(0,0,0,.08);padding:36px 28px 32px;
    }
    .card h2{margin:0 0 10px;font-size:36px;color:var(--primary-color);text-align:center}
    .card p.lead{margin:0 0 24px;text-align:center;color:#56606b;font-size:18px}

    .form-group{margin-bottom:16px;}
    label{display:block;margin-bottom:6px;font-weight:500}
    input[type="email"]{
      width:100%;padding:12px 14px;border:1.5px solid #dfe3e6;border-radius:12px;
      font-size:16px;outline:none;transition:border .2s, box-shadow .2s;background:#fff;
    }
    input[type="email"]:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(0,128,128,.12)}
    .actions{margin-top:8px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{
      appearance:none;border:0;border-radius:999px;padding:12px 22px;font-size:16px;
      font-weight:600;cursor:pointer;transition:transform .02s ease, opacity .2s;
    }
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--primary-color);color:#fff}
    .btn-primary[disabled]{opacity:.65;cursor:not-allowed}
    .btn-outline{background:#fff;color:var(--primary-color);border:2px solid var(--primary-color)}
    .helper{font-size:14px;color:#666}
    .error{margin-top:10px;color:#c62828;font-weight:500}
    .success-cta{display:flex;justify-content:center;margin-top:24px}

    /* Success state */
    #success-panel{display:none;text-align:center}
    #success-panel h2{font-size:40px}
    #success-panel p{font-size:20px;line-height:1.6;color:#56606b}

    @media (max-width:640px){
      .project-info h1{font-size:18px}
      .navbar a{padding:12px 16px}
      .card{padding:28px 20px}
      .card h2{font-size:28px}
      #success-panel h2{font-size:30px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">LOGO</div>
        <div class="project-info">
          <h1>HỖ TRỢ HUẤN LUYỆN THỂ THAO</h1>
          <p>DỰ ÁN KHOA HỌC KỸ THUẬT</p>
        </div>
      </div>
      <div class="user-actions">
        <a href="dangnhap.html" id="login-link" aria-label="Đăng nhập">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          <span>Đăng nhập</span>
        </a>
        <a href="dangki.html" id="register-link" aria-label="Đăng ký">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="17" y1="11" x2="23" y2="11"/></svg>
          <span>Đăng ký</span>
        </a>
        <a href="#" id="logout-link" style="display:none" aria-label="Đăng xuất">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          <span>Đăng xuất</span>
        </a>
      </div>
    </header>

    <!-- Nav -->
    <nav class="navbar">
      <a href="index.html">Trang chủ</a>
      <a href="gioithieu.html">Giới thiệu</a>
      <a href="bangdieukhien.html" id="dashboard-link" style="display:none">Bảng điều khiển</a>
    </nav>

    <!-- Main -->
    <main>
      <div class="card">
        <!-- FORM STATE -->
        <section id="form-panel" aria-live="polite">
          <h2>Đặt lại mật khẩu</h2>
          <p class="lead">Nhập địa chỉ email bạn đã đăng ký để nhận liên kết đặt lại mật khẩu.</p>

          <form id="reset-form" novalidate>
            <div class="form-group">
              <label for="email">Email</label>
              <input id="email" name="email" type="email" placeholder="vd: ban@example.com" autocomplete="email" required />
              <div class="helper">Liên kết sẽ được gửi từ <em>firebaseauth</em>. Nhớ kiểm tra mục Spam/Quảng cáo.</div>
            </div>

            <div class="actions">
              <button class="btn btn-primary" id="submit-btn" type="submit">Gửi liên kết đặt lại</button>
              <a class="btn btn-outline" href="dangnhap.html">Quay lại đăng nhập</a>
            </div>

            <div id="error-box" class="error" role="alert" aria-live="assertive"></div>
          </form>
        </section>

        <!-- SUCCESS STATE -->
        <section id="success-panel" aria-live="polite">
          <h2>Kiểm tra hộp thư của bạn</h2>
          <p>Chúng tôi đã gửi một liên kết đặt lại mật khẩu đến email của bạn. Vui lòng làm theo hướng dẫn trong email để tạo mật khẩu mới.</p>
          <div class="success-cta">
            <a class="btn btn-primary" href="dangnhap.html">Quay lại đăng nhập</a>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Firebase Auth -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA2dXWCyjL2xgCSyeW9QQ7RvjI_O7kFHJw",
      authDomain: "sporthealthdata.firebaseapp.com",
      projectId: "sporthealthdata",
      storageBucket: "sporthealthdata.appspot.com",
      messagingSenderId: "789054240877",
      appId: "1:789054240877:web:04a400c9ea586523a86764",
      measurementId: "G-ZWS9C7P359"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Toggle các nút theo trạng thái đăng nhập
    const loginLink = document.getElementById('login-link');
    const registerLink = document.getElementById('register-link');
    const logoutLink = document.getElementById('logout-link');
    const dashboardLink = document.getElementById('dashboard-link');

    onAuthStateChanged(auth, (user) => {
      if (user) {
        if (dashboardLink) dashboardLink.style.display = 'block';
        if (logoutLink) logoutLink.style.display = 'inline-flex';
        if (loginLink) loginLink.style.display = 'none';
        if (registerLink) registerLink.style.display = 'none';
      } else {
        if (dashboardLink) dashboardLink.style.display = 'none';
        if (logoutLink) logoutLink.style.display = 'none';
        if (loginLink) loginLink.style.display = 'inline-flex';
        if (registerLink) registerLink.style.display = 'inline-flex';
      }
    });

    if (logoutLink) {
      logoutLink.addEventListener('click', (e) => {
        e.preventDefault();
        signOut(auth).catch((error) => console.error('Lỗi khi đăng xuất:', error));
      });
    }

    // Reset password logic
    const form = document.getElementById("reset-form");
    const emailInput = document.getElementById("email");
    const errorBox = document.getElementById("error-box");
    const submitBtn = document.getElementById("submit-btn");
    const formPanel = document.getElementById("form-panel");
    const successPanel = document.getElementById("success-panel");

    const showError = (msg) => {
      errorBox.textContent = msg || "";
    };

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      showError("");

      const email = emailInput.value.trim();
      if (!email) {
        showError("Vui lòng nhập email.");
        emailInput.focus();
        return;
      }

      try {
        submitBtn.disabled = true;
        const prev = submitBtn.textContent;
        submitBtn.textContent = "Đang gửi...";

        await sendPasswordResetEmail(auth, email, {
          // Tuỳ chọn: cho người dùng quay lại trang đăng nhập của bạn
          url: `${location.origin}/dangnhap.html`,
          handleCodeInApp: false
        });

        // Hiển thị trạng thái thành công
        formPanel.style.display = "none";
        successPanel.style.display = "block";

        submitBtn.textContent = prev;
        submitBtn.disabled = false;
      } catch (e) {
        const map = {
          "auth/invalid-email": "Địa chỉ email không hợp lệ.",
          "auth/user-not-found": "Email chưa đăng ký tài khoản.",
          "auth/too-many-requests": "Bạn thao tác quá nhanh. Vui lòng thử lại sau ít phút.",
        };
        showError(map[e.code] || `Không gửi được email: ${e.code}`);
        console.error(e);

        submitBtn.disabled = false;
        submitBtn.textContent = "Gửi liên kết đặt lại";
      }
    });
  </script>
</body>
</html>

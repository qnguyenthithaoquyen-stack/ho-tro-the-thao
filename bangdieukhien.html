<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng điều khiển</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        body { font-family: 'Roboto', sans-serif; margin: 0; background-color: #f0f2f5; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; background-color: #fff; box-shadow: 0 0 15px rgba(0, 0, 0, 0.07); }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background-color: #008080; color: #fff; }
        .header-left { display: flex; align-items: center; }
        .logo { background-color: #fff; color: #008080; font-weight: 700; padding: 10px; border-radius: 5px; margin-right: 15px; }
        .project-info h1 { font-size: 24px; margin: 0; font-weight: 700; }
        .project-info p { font-size: 12px; margin: 0; opacity: 0.9; }
        .user-actions a { background-color: #fff; color: #008080; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: 700; text-decoration: none; font-size: 14px; margin-left: 10px; }
        .navbar { display: flex; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,.05); padding: 0 30px; }
        .navbar a { padding: 15px 25px; text-decoration: none; color: #333; font-weight: 500; position: relative; }
        .navbar a::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 0; height: 3px; background-color: #008080; transition: width 0.3s ease; }
        .navbar a:hover, .navbar a.active { color: #008080; }
        .navbar a.active::after { width: 70%; }
        .main-content { padding: 40px 30px; min-height: 400px; }
        .login-prompt-card, .dashboard-content { background-color: #fff; border-radius: 16px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); padding: 60px 80px; text-align: center; max-width: 500px; margin: 40px auto; }
        .login-prompt-card h2, .dashboard-content h2 { font-size: 32px; font-weight: 700; margin-top: 0; margin-bottom: 15px; color: #008080; }
        .login-prompt-card p, .dashboard-content p { font-size: 16px; line-height: 1.6; color: #555; margin-bottom: 30px; }
        .action-button { background-color: #008080; color: #fff; border: none; padding: 14px 28px; border-radius: 25px; cursor: pointer; font-weight: 700; font-size: 16px; text-decoration: none; display: inline-block; transition: all 0.3s; }
        .action-button:hover { background-color: #006666; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        /* Ẩn nội dung mặc định */
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <div class="header-left">
                <div class="logo">LOGO</div>
                <div class="project-info">
                    <h1>HỖ TRỢ HUẤN LUYỆN THỂ THAO</h1>
                    <p>DỰ ÁN KHOA HỌC KỸ THUẬT - ỨNG DỤNG THEO DÕI CHỈ SỐ VẬN ĐỘNG VIÊN</p>
                </div>
            </div>
            <!-- Khu vực này sẽ được cập nhật bằng JavaScript -->
            <div id="user-actions-container" class="user-actions">
                 <a href="dangnhap.html" class="login-btn">Đăng nhập</a>
            </div>
        </header>

        <nav class="navbar">
            <a href="index.html">Trang chủ</a>
            <a href="gioithieu.html">Giới thiệu</a>
            <a href="bangdieukhien.html" class="active">Bảng điều khiển</a>
        </nav>

        <main class="main-content">
            <!-- Giao diện khi chưa đăng nhập (mặc định) -->
            <div id="login-prompt" class="login-prompt-card">
                <h2>Vui lòng đăng nhập</h2>
                <p>Bạn cần đăng nhập để xem Bảng điều khiển.</p>
                <a href="dangnhap.html" class="action-button">Đi đến trang đăng nhập</a>
            </div>

            <!-- Giao diện khi đã đăng nhập (bị ẩn mặc định) -->
            <div id="dashboard-content" class="dashboard-content hidden">
                <h2>Chào mừng trở lại!</h2>
                <p>Đây là khu vực Bảng điều khiển của bạn.</p>
                <p id="user-email-display"></p>
                <!-- Nội dung bảng điều khiển sẽ được thêm vào đây -->
            </div>
        </main>
    </div>

    <!-- Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA2dXWCyjL2xgCSyeW9QQ7RvjI_O7kFHJw",
            authDomain: "sporthealthdata.firebaseapp.com",
            projectId: "sporthealthdata",
            storageBucket: "sporthealthdata.appspot.com",
            messagingSenderId: "789054240877",
            appId: "1:789054240877:web:04a400c9ea586523a86764",
            measurementId: "G-ZWS9C7P359"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Lắng nghe sự thay đổi trạng thái đăng nhập
        auth.onAuthStateChanged(user => {
            const loginPrompt = document.getElementById('login-prompt');
            const dashboardContent = document.getElementById('dashboard-content');
            const userActionsContainer = document.getElementById('user-actions-container');
            const userEmailDisplay = document.getElementById('user-email-display');

            if (user) {
                // --- NGƯỜI DÙNG ĐÃ ĐĂNG NHẬP ---
                // 1. Ẩn thông báo yêu cầu đăng nhập
                loginPrompt.classList.add('hidden');
                // 2. Hiện nội dung bảng điều khiển
                dashboardContent.classList.remove('hidden');
                userEmailDisplay.textContent = `Bạn đang đăng nhập với email: ${user.email}`;

                // 3. Thay đổi nút "Đăng nhập" thành "Đăng xuất"
                userActionsContainer.innerHTML = '<a href="#" id="logout-btn">Đăng xuất</a>';

                // 4. Gắn sự kiện cho nút đăng xuất MỚI
                const logoutButton = document.getElementById('logout-btn');
                if (logoutButton) {
                    logoutButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        auth.signOut().then(() => {
                            alert('Đăng xuất thành công!');
                            window.location.href = 'dangnhap.html';
                        }).catch(error => {
                            console.error('Lỗi đăng xuất:', error);
                        });
                    });
                }

            } else {
                // --- NGƯỜI DÙNG CHƯA ĐĂNG NHẬP ---
                // 1. Hiện thông báo yêu cầu đăng nhập
                loginPrompt.classList.remove('hidden');
                // 2. Ẩn nội dung bảng điều khiển
                dashboardContent.classList.add('hidden');
                // 3. Đảm bảo nút là "Đăng nhập"
                userActionsContainer.innerHTML = '<a href="dangnhap.html">Đăng nhập</a>';
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng điều khiển</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        body { font-family: 'Roboto', sans-serif; margin: 0; background-color: #f0f2f5; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; background-color: #fff; box-shadow: 0 0 15px rgba(0, 0, 0, 0.07); }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background-color: #008080; color: #fff; }
        .header-left { display: flex; align-items: center; }
        .logo { background-color: #fff; color: #008080; font-weight: 700; padding: 10px; border-radius: 5px; margin-right: 15px; }
        .project-info h1 { font-size: 24px; margin: 0; font-weight: 700; }
        .project-info p { font-size: 12px; margin: 0; opacity: 0.9; }
        .user-actions a { background-color: #fff; color: #008080; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: 700; text-decoration: none; font-size: 14px; margin-left: 10px; }
        .navbar { display: flex; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,.05); padding: 0 30px; }
        .navbar a { padding: 15px 25px; text-decoration: none; color: #333; font-weight: 500; position: relative; }
        .navbar a.active { color: #008080; }
        .main-content { padding: 40px 30px; min-height: 400px; }
        .dashboard-card { background-color: #fff; border-radius: 16px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); padding: 40px; text-align: center; max-width: 800px; margin: 40px auto; }
        .dashboard-card h2 { font-size: 32px; font-weight: 700; margin-top: 0; margin-bottom: 15px; color: #008080; }
        .dashboard-card p { font-size: 16px; line-height: 1.6; color: #555; margin-bottom: 30px; }
        .hidden { display: none; }
        /* === CSS MỚI CHO CÁC CHỨC NĂNG === */
        .functions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
            text-align: left;
        }
        .function-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        .function-card h3 {
            margin-top: 0;
            color: #008080;
        }
        .function-card a {
            display: inline-block;
            margin-top: 15px;
            background-color: #008080;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <div class="header-left">
                <div class="logo">LOGO</div>
                <div class="project-info"><h1>HỖ TRỢ HUẤN LUYỆN THỂ THAO</h1><p>DỰ ÁN KHOA HỌC KỸ THUẬT</p></div>
            </div>
            <div id="user-actions-container" class="user-actions">
                 <a href="dangnhap.html" class="login-btn">Đăng nhập</a>
            </div>
        </header>

        <nav class="navbar">
            <a href="index.html">Trang chủ</a>
            <a href="gioithieu.html">Giới thiệu</a>
            <a href="bangdieukhien.html" class="active">Bảng điều khiển</a>
        </nav>

        <main class="main-content">
            <!-- Giao diện khi chưa đăng nhập -->
            <div id="login-prompt" class="dashboard-card">
                <h2>Vui lòng đăng nhập</h2>
                <p>Bạn cần đăng nhập để xem Bảng điều khiển.</p>
                <a href="dangnhap.html" style="color: #008080;">Đi đến trang đăng nhập</a>
            </div>

            <!-- === ĐÃ CẬP NHẬT GIAO DIỆN CHO HUẤN LUYỆN VIÊN === -->
            <div id="coach-dashboard" class="dashboard-card hidden">
                <h2>Bảng điều khiển Huấn Luyện Viên</h2>
                <p>Chào mừng, <span id="coach-name"></span>!</p>
                <div class="functions-grid">
                    <div class="function-card">
                        <h3>Quản lý Vận động viên</h3>
                        <p>Thêm, sửa, xóa thông tin và theo dõi chỉ số của các vận động viên.</p>
                        <a href="#">Bắt đầu</a>
                    </div>
                    <div class="function-card">
                        <h3>Lịch tập luyện</h3>
                        <p>Tạo và quản lý lịch tập cho cá nhân hoặc cả đội.</p>
                        <a href="#">Xem lịch</a>
                    </div>
                    <div class="function-card">
                        <h3>Báo cáo & Thống kê</h3>
                        <p>Xem báo cáo tiến độ và hiệu suất của vận động viên.</p>
                        <a href="#">Xem báo cáo</a>
                    </div>
                </div>
            </div>

            <!-- Giao diện cho Vận Động Viên (ẩn mặc định) -->
            <div id="athlete-dashboard" class="dashboard-card hidden">
                <h2>Bảng điều khiển Vận Động Viên</h2>
                <p>Chào mừng, <span id="athlete-name"></span>!</p>
                 <div class="functions-grid">
                    <div class="function-card">
                        <h3>Xem Lịch tập</h3>
                        <p>Kiểm tra lịch tập luyện hàng ngày và hàng tuần của bạn.</p>
                        <a href="#">Xem ngay</a>
                    </div>
                    <div class="function-card">
                        <h3>Nhập Chỉ số</h3>
                        <p>Cập nhật các chỉ số sức khỏe và hiệu suất sau mỗi buổi tập.</p>
                        <a href="#">Nhập chỉ số</a>
                    </div>
                </div>
            </div>
            
            <!-- Giao diện mặc định nếu không có vai trò -->
             <div id="default-dashboard" class="dashboard-card hidden">
                <h2>Chào mừng trở lại!</h2>
                <p>Đây là khu vực Bảng điều khiển của bạn.</p>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA2dXWCyjL2xgCSyeW9QQ7RvjI_O7kFHJw",
            authDomain: "sporthealthdata.firebaseapp.com",
            projectId: "sporthealthdata",
            storageBucket: "sporthealthdata.appspot.com",
            messagingSenderId: "789054240877",
            appId: "1:789054240877:web:04a400c9ea586523a86764",
            measurementId: "G-ZWS9C7P359"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const auth = firebase.auth();
        const db = firebase.firestore();

        const loginPrompt = document.getElementById('login-prompt');
        const coachDashboard = document.getElementById('coach-dashboard');
        const athleteDashboard = document.getElementById('athlete-dashboard');
        const defaultDashboard = document.getElementById('default-dashboard');
        const userActionsContainer = document.getElementById('user-actions-container');

        // Lắng nghe sự thay đổi trạng thái đăng nhập
        auth.onAuthStateChanged(user => {
            if (user) {
                // --- NGƯỜI DÙNG ĐÃ ĐĂNG NHẬP ---
                loginPrompt.classList.add('hidden');
                
                // Thay đổi nút "Đăng nhập" thành "Đăng xuất"
                userActionsContainer.innerHTML = '<a href="#" id="logout-btn">Đăng xuất</a>';
                const logoutButton = document.getElementById('logout-btn');
                if (logoutButton) {
                    logoutButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        auth.signOut().then(() => {
                            window.location.href = 'dangnhap.html';
                        });
                    });
                }

                // Lấy thông tin vai trò từ Firestore
                const userDocRef = db.collection('users').doc(user.uid);
                userDocRef.get().then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        const userRole = userData.role;
                        const userName = userData.fullName || user.email;

                        // Hiển thị giao diện dựa trên vai trò
                        if (userRole === 'coach') {
                            document.getElementById('coach-name').textContent = userName;
                            coachDashboard.classList.remove('hidden');
                        } else if (userRole === 'athlete') {
                             document.getElementById('athlete-name').textContent = userName;
                            athleteDashboard.classList.remove('hidden');
                        } else {
                            defaultDashboard.classList.remove('hidden');
                        }
                    } else {
                        // Nếu không tìm thấy thông tin người dùng, hiển thị giao diện mặc định
                        console.log("Không tìm thấy thông tin người dùng trong Firestore!");
                        defaultDashboard.classList.remove('hidden');
                    }
                }).catch((error) => {
                    console.error("Lỗi khi lấy thông tin người dùng:", error);
                    defaultDashboard.classList.remove('hidden');
                });

            } else {
                // --- NGƯỜI DÙNG CHƯA ĐĂNG NHẬP ---
                loginPrompt.classList.remove('hidden');
                coachDashboard.classList.add('hidden');
                athleteDashboard.classList.add('hidden');
                defaultDashboard.classList.add('hidden');
                userActionsContainer.innerHTML = '<a href="dangnhap.html">Đăng nhập</a>';
            }
        });
    </script>
</body>
</html>
